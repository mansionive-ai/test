<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>이야기 페이지</title>
<style>
  html, body {
    height: 100%;
    margin: 0;
    font-family: system-ui, -apple-system, Roboto, 'Noto Sans KR', sans-serif;
    background: linear-gradient(120deg,#0f172a,#0b1220);
    color: #fff;
  }
  .wrap {
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    text-align: center;
    padding: 2rem;
  }
  .card {
    background: none;
    backdrop-filter: none;
    padding: 0;
    box-shadow: none;
  }
  audio { display: none; }

  #backBtn {
    position: fixed;
    top: 5px;
    left: 5px;
    padding: 8px 16px;
    font-size: 18px;
    z-index: 1000;
    background: rgba(51, 65, 85, 0.8);
    border: none;
    color: #fff;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.3s;
  }
  #backBtn:hover {
    background: rgba(71, 85, 105, 0.9);
  }

  #continueBtn {
    margin-top: 1rem;
    padding: 0.75rem 1.5rem;
    background: #3b82f6;
    border: none;
    color: #fff;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
    transition: background 0.3s;
  }
  #continueBtn:hover {
    background: #2563eb;
  }

  #codeInput {
    padding: 0.75rem;
    font-size: 16px;
    border: 2px solid #475569;
    border-radius: 6px;
    background: #1e293b;
    color: #fff;
    margin-top: 1rem;
    width: 200px;
    text-align: center;
  }
  #codeInput:focus {
    outline: none;
    border-color: #3b82f6;
  }

  #submitBtn {
    margin-top: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: #10b981;
    border: none;
    color: #fff;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
    transition: background 0.3s;
  }
  #submitBtn:hover {
    background: #059669;
  }

  #msg {
    margin-top: 0.5rem;
    opacity: 0.8;
    color: #ef4444;
    font-weight: bold;
  }

  .choice-btn {
    display: block;
    margin: 0.75rem auto;
    padding: 0.75rem 1.5rem;
    background: #6366f1;
    border: none;
    color: #fff;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
    transition: background 0.3s;
    min-width: 250px;
  }
  .choice-btn:hover {
    background: #4f46e5;
  }

  video {
    max-width: 100%;
    border-radius: 8px;
  }
</style>
</head>
<body>

<button id="backBtn">←</button>

<div class="wrap">
  <div class="card" id="card"></div>

  <audio id="bgm" loop preload="auto">
    <source src="./bgm.mp3" type="audio/mpeg">
  </audio>
  <audio id="sfx" preload="auto"></audio>
</div>

<div id="confirmPopup" style="
  display:none; position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.7); backdrop-filter:blur(4px);
  align-items:center; justify-content:center; z-index:2000;">

  <div style="background:#1e293b; padding:30px; border-radius:12px; text-align:center; box-shadow: 0 10px 40px rgba(0,0,0,0.5);">
    <p style="font-size:18px; margin-bottom:20px;">이어하기가 존재합니다.<br>정말로 새로 시작합니까?</p>
    <button id="yesBtn" style="margin-right:10px; padding:10px 20px; background:#ef4444; border:none; color:#fff; border-radius:6px; cursor:pointer; font-size:16px;">네</button>
    <button id="noBtn" style="padding:10px 20px; background:#6b7280; border:none; color:#fff; border-radius:6px; cursor:pointer; font-size:16px;">아니요</button>
  </div>
</div>

<script>
const audio = document.getElementById('bgm');
const sfx = document.getElementById('sfx');
const wrap = document.querySelector('.wrap');

let currentPage = 0;
let pageHistory = [];  // 페이지 히스토리 추적
let audioUnlocked = false;  // 오디오 잠금 해제 여부

const pages = {
  0: "클릭하여 시작<br>",
  1: '"정신 차리세요~"',
  2: '"드디어 일어나셨군요."',
  3: '눈을 뜨자 처음 보는 여자가 나를 뚫어지게 바라보고 있었다.',
  4: '"몸은 괜찮으신가요?"',
  5: '"네"<br><br>나는 정신없이 그녀의 질문에 답하며 주변을 둘러보았다.',
  6: '끝없이 이어진 노란색 벽과 형광등 불빛만이 허공에 떠 있었다.',
  7: '눅눅하고 축축한 공기, 사방으로 길게 이어진 복도는 끝없이 늘어져 있다.',
  8: '주위에는 웅웅거리는 소리뿐, 공허하게 울리는 내 목소리는 마치 세상과 단절된 것처럼 느껴진다.',
  9: '"저도 눈을 떠보니 이런 알 수 없는 공간에 있었어요."',
  10: '"아, 제 이름은 일레이나예요."',
  11: '그녀는 자신을 일레이나라고 소개했다.<br><br>"저는..."',
  12: '나는... 누구지?',
  13: '내 머릿속은 텅텅 빈 듯 아무것도 기억나지 않았다.',
  14: '일레이나 씨는 나를 걱정하는 듯 보였다.',
  15: '"어디 안 좋으세요...?"',
  16: '"놀랍게도 저에 대해서 기억이 나지 않아요."',
  17: '"기억상실인가요?<br><br>이 공간에 올 때 머리를 부딪치셨을지도 모르겠어요."',
  18: '"......"',
  19: '"저도 똑같은 것 같아요."',
  20: '"제가 어쩌다가 이곳에 왔는지, 뭘 하던 사람인지, 아무것도 모르겠어요."',
  21: '"저는 그래도 제 이름은 기억하네요."',
  22: '일레이나 씨도 기억이 혼란스러운 모양이다.',
  23: '가만히 구조를 기다려야 할까?',
  24: '아니다. 지금 상황은 아무리 봐도 정상이 아니다.',
  25: '"......"',
  26: '"한곳에 가만히 있기도 좀 그러니 움직이겠어요?"',
  27: '"네."<br><br>나와 일레이나 씨는 같이 움직이기 시작했다.',
  28: '끝없이 이어지는 같은 풍경, 마치 미로처럼 느껴진다.',
  29: '2분 정도 지났을까? 두 사람은 아무 말 없이 발을 맞춰 걸어나갔다.',
  30: '"끝이 없네요."',
  31: '"그러게요."<br><br>약간 어색한 분위기에서 일레이나 씨가 나에게 고개를 돌리며 말했다.',
  32: '"어?"',
  33: '일레이나 씨는 뭔가를 보고 멈추었다.',
  34: '"이게 뭘까요?"',
  35: '벽지에 무언가 적혀 있다.<br><br>이건 숫자 관련된 문제일까?',
  36: '"?에 들어갈 숫자를 찾으라는 것 같네요."',
  37: '나는 왠지 모르게 간단히 풀 수 있을 것 같았다.',
  38: '?에 들어갈 숫자, 분명 규칙이 있을 것이다.',
  39: '"정답은 576이네요."',
  40: '"풀이가 뭔가요?"',
  41: '"8단입니다."',
  42: '"팔 일은 팔, 팔 이십육, 팔 삼은 이십사."' ,
  43: '"..!"',
  44: '"그렇죠?"',
  45: '"저는 그런 발상조차도 못했어요. 대단하세요."',
  46: '"아닙니다. 이런 건 기억이 나는 법이군요."<br><br>나는 어색하게 웃으며 말했다.',
  47: '후... 위험했다. 나는 여자에 약한 타입인가? 웃는 모습이 너무 예쁘잖아...!',
  48: '객관적으로 보나 주관적으로 보나 일레이나 씨는 굉장한 미인이다.<br><br>그래서 그런 건지 내성적인 성격 탓인지 쑥스러워서 말이 잘 나오지 않는다.',
  49: '"왜 그러세요?"',
  50: '"576은 혹시 모르니 기억해 놓죠."',
  51: '"그게 좋겠어요."',
  52: 'chapter 1<br><br>『백룸』',
  53: '걸어도 걸어도 끝없이 이어지는 같은 풍경',
  54: '일레이나 씨와 나는 그저 계속 걸을 뿐이었다.',
  55: '대체 누가 어떤 목적으로 나와 일레이나 씨를 이곳에 데려온 건지, 기억은 왜 없는 건지.',
  56: '이 이상한 장소는 대체 어떠한 이유로 만들어졌는지 알 수 없는 것투성이다.',
  57: '"저기, 괜찮으세요? 조금만 쉬었다 갈까요?"',
  58: '"네."',
  59: '"......"',
  60: '"저희, 어떻게 된 걸까요?"',
  61: '"어떻게 되다니요?"',
  62: '"사실 저희는 이미 죽은 게 아닐까요...?"',
  63: '"아무리 생각해도 이곳은 이상하잖아요."<br><br>나가는 문은커녕 창문조차 하나도 없어요.',
  64: '"마음은 충분히 이해합니다만, 저희는 이렇게 숨을 쉬고 살아 있어요."',
  65: '"고통도 느껴지고요."<br><br>나는 내 볼을 꼬집으며 말했다.',
  66: '"어쨌든 저희는 최소한 비현실적인 이상 현상에 휘말린 건 분명해요."',
  67: '"네, 저도 그렇게 생각합니다."',
  68: '미지의 공간, 기억상실',
  69: '계속해서 웅웅거리는 소리',
  70: '이대로 계속 가다가는 정신이 미쳐버릴 것 같다.',
  71: '그나마 나와 함께 옆에서 걷고 있는 일레이나 씨의 모습을 보면<br><br>의지가 되는 듯한 기분이 든다.',
  72: '"어? 이 벽에도 무언가 있어요!"',
  73: '벽에는 전처럼 누군가 의도적으로 적은 듯한 숫자와 물음표가 있다.',
  74: '"음..."',
  75: '"물음표에 들어갈 숫자를 찾아야 할까요?"',
  76: '이게 대체 무슨 숫자 규칙인 거지?',
  77: '이번 문제는 감이 오질 않아. 어떠한 숫자 배열인 걸까?',
  78: '"파이군요."',
79:'"초코파이."',
80:'"네?"',
81:'"네?"',
82:'"그러고 보니 아까부터 배가 고프네요."',
83:'"그러게요. 저흰 가진 게 아무것도 없으니..."',
84:'"체력이 바닥 나기 전에 탈출구를 찾아야겠어요."',
85:'"쉿."',
86:'"일레이나 씨...?"',
87:'그녀는 갑자기 내 팔을 양손으로 붙잡더니 강제로 끌고 가려는 듯이 힘을 주었다.',
88:'작은 그녀의 손은 미세하게 떨리고 있다.',
89:'나와 그녀는 빠른 걸음으로 계속해서 이동했다.',
90:'"저기, 왜 그러세요?"',
91:'"무언가 있었어요."',
92:'"무언가...?"',
93:'"사람은 아니에요."',
94:'"뒤에서 분명 뭔가 스쳐 지나가듯 코너 벽으로 쓱..."',
95:'"분명 제가 잘못 본 거겠죠...?"',
96:'무언가 우리를 감시하고 있다?',
97:'"계속해서 빠르게 이동하는 게 좋겠어요."',
98:'뭔가 묘한 느낌이다.',
99:'이상한 장소, 기억의 혼란.',
100:'누군가 우리를 어떠한 목적으로 데려왔다면',
101:'감시자가 있어도 전혀 이상할 건 없다.',
102:'"사람이 아니라는 건 무슨 뜻이죠?"<br><br>일레이나 씨를 보고 물었다.',
103:'"말 그대로 제가 본 건 최소한 사람은 아니에요."',
104:'"검은색 그림자 같은 형태였어요."',
105:'"알겠습니다."',
106:'"기분 탓이었으면 좋겠어요."',
107:'우린 전보다 빠른 걸음으로 걷고 또 걸었다.',
108:'그리고 또 벽에 적힌 숫자 문제를 발견하게 되었다.',
109:'"여기에도 있네요."',
110:'"문제는 제가 풀겠습니다."',
111:'"혹시 모르니 일레이나 씨는 주변을 경계해주세요."',
112:'"좋아요."',
113:'보자...',
114:'규칙을 찾아 ?에 들어갈 숫자를 찾는 것이다.',
115:'한번 풀어보자.',
116:'나는 집중해서 문제를 풀고 있다.',
117:'일레이나 씨는 주변을 지키고 있다.',
118:'문제를 뚫어져라 쳐다보고 있던 그 순간',
119:'뒤에서 들려오는 너무나 소름 끼치는 소리',
120:'"도망... 도망쳐요..!"',
121:'뒤를 돌아본 그곳에는 괴상한 소리를 내며 돌진해 오는 무언가가 있었다.',
122:'나는 즉시 일레이나 씨의 손을 붙잡고 소리쳤다.<br><br>달려요!!!',
123:'쿵ㅡ쿵ㅡ쿵ㅡㅡ! 꺽..꺽..꺽..ㅡㅡㅡ',
124:'요동치는 무언가의 발소리와 울음소리는 전신에 소름이 끼쳐왔다.',
125:'나는 이 괴물에게 붙잡히면 죽는다는 걸 본능적으로 깨닫고 죽기 살기로 달렸다.',
126:'달리고... 또 달렸다...',
127:'체력의 한계가 찾아왔을 때쯤, 더 이상 괴물의 소리는 들리지 않는다는 것을 깨달았다.',
128:'"헉... 헉... 헉..."',
129:'"하아... 하아... 하아..."',
130:'그녀와 나는 바닥에 쓰러져 숨을 한동안 가쁘게 쉬었다.',
131:'"다친 곳 없으세요?"<br><br> 숨을 가쁘게 쉬며 물었다.',
132:'일레이나씨는 대답 대신 숨소리만 들렸다.',
133:'몇 분 후 호흡이 좀 진정이 됐다.',
134:'"저건 대체..."',
135:'"......"',
136:'"미스터리한 생명체였네요."',
137:'"저희는 외계인에게 납치라도 당한 걸까요...?"',
138:'"그럴 수도 있겠네요."',
139:'"후... 하..."',
140:'"괜찮으세요?"',
141:'"네, 우선 이제부터 어떻게 할지 생각해보아요."',
142:'"저 괴물이 저희를 노리고 있는 건 분명합니다."',
143:'"이곳에 계속 있다가는 언젠가 들키겠죠."',
144:'"그럼 이동할까요?"',
145:'"잠시만요. 아까 보았던 수학 문제..."',
146:'"윗줄은 25, 11, 11, 15, 24, ?<br><br>아랫줄은 13, 45, 67, 189, 33이었어요."',
147:'"윗줄 사이 간격마다 아랫줄 숫자 위치가 들어가 있었죠. 마치 의도된 것 같아요."',
148:'"맞아요. 기억력이 좋으시네요."',
149:'"그런가요?"',
150:'"문제는 저에게 맡기시고 주변 경계 부탁드립니다."<br><br>이 문제들이 괜히 있는 것이 아닐 거다. 분명 탈출의 열쇠이다.',
151:'"일단 계속해서 이동하죠."',
152:'일레이나 씨는 씩씩하게 일어나 걷기 시작했다.',
153:'이 상황이 굉장히 무섭지만, 그렇다고 떨고만 있어서는 생존할 수 없다.',
154:'"저기..."',
155:'"이름을 어떻게 부르면 좋을까요?"',
156:'"계속 저기요라고 부르는 것도 좀 그러잖아요."',
157:'"글쎄요..."<br><br>이름이라... 전혀 기억이 나지 않아',
158:'내 이름은...' ,
159: "씨.. 좋은 이름이네요!",
  10000: "책장을 조사했다. 먼지가 가득하다.",
  10003: "가방 안에는 오래된 지도가 있다.",
  10005: "액자 뒤에 숨겨진 메모를 발견했다.",
  10007: "금고는 비밀번호가 필요하다."
};


const pageImages = {
  0: "./Dream Time.jpg",
  2: "./일레이나/기본.jpg",
  4: "./일레이나/기본.jpg",
  6: "./배경/백룸.jpg",
  7: "./배경/백룸.jpg",
  8: "./배경/백룸.jpg",
  9: "./일레이나/시크.jpg",
  10: "./일레이나/기본.jpg",
  15: "./일레이나/기본.jpg",
  17: "./일레이나/기본.jpg",
  18: "./일레이나/시크.jpg",
  19: "./일레이나/걱정.jpg",
  20: "./일레이나/기본.jpg",
  21: "./일레이나/시크.jpg",
  25: "./일레이나/시크.jpg",
  26: "./일레이나/기본.jpg",
  30: "./일레이나/일어남.jpg",
  32: "./일레이나/일어남.jpg",
  34: "./일레이나/기본2.jpg",
  35: "./문제/1.jpg",
  36: "./문제/1.jpg",
  37: "./문제/1.jpg",
  38: "./문제/1.jpg",
  40: "./일레이나/기본2.jpg",
  42: "./일레이나/기본2.jpg",
  43: "./일레이나/놀람.jpg",
  45: "./일레이나/미소.jpg",
  49: "./일레이나/기본2.jpg",
  51: "./일레이나/기본.jpg",
58:"./일레이나/일어남.jpg",
59:"./일레이나/시크.jpg",
60:"./일레이나/기본.jpg",
62:"./일레이나/시크.jpg",
63:"./일레이나/기본.jpg",
66:"./일레이나/시크.jpg",
72:"./일레이나/일어남.jpg",
73:"./문제/2.jpg",
74:"./일레이나/기본.jpg",
75:"./일레이나/기본2.jpg",
77:"./문제/2.jpg",
79: "./일레이나/기본.jpg",
81: "./일레이나/기본2.jpg",
82: "./일레이나/배고픔.jpg",
85: "./일레이나/진지.jpg",
91: "./일레이나/진지.jpg",
93: "./일레이나/진지.jpg",
94: "./일레이나/진지.jpg",
95: "./일레이나/소름.jpg",
103: "./일레이나/긴장.jpg",
104: "./일레이나/긴장.jpg",
106: "./일레이나/긴장.jpg",
112: "./일레이나/진지.jpg",
113: "./문제/3.jpg",
114: "./문제/3.jpg",
115: "./문제/3.jpg",
120: "./일레이나/도망.jpg",
121: "./배경/무언가.jpg",
129: "./일레이나/달림.jpg",
134: "./일레이나/달림.jpg",
137: "./일레이나/달림.jpg",
139: "./일레이나/달림.jpg",
141: "./일레이나/긴장.jpg",
144: "./일레이나/초조.jpg",
146: "./일레이나/긴장.jpg",
147: "./일레이나/긴장.jpg",
149: "./일레이나/긴장.jpg",
151: "./일레이나/진지.jpg",
154: "./일레이나/일어남.jpg",
155: "./일레이나/일어남.jpg",
156: "./일레이나/일어남.jpg",
159: "./일레이나/일어남.jpg"

};

const pageImageStyles = {
  0: "width:350px; margin-top:10px;",
  1: "width:250px; margin-top:0px; transform:translateX(-240px);",
  2: "width:250px; margin-top:-100px;",
  3: "width:250px; margin-top:-100px;",
  4: "width:250px; margin-top:-100px;",
  5: "width:250px; margin-top:-100px;",
  6: "width:250px; margin-top:-100px;",
  7: "width:250px; margin-top:-100px;",
  8: "width:250px; margin-top:-100px;",
  9: "width:250px; margin-top:-100px;",
  10: "width:250px; margin-top:-100px;",
  15: "width:250px; margin-top:-100px;",
  17: "width:250px; margin-top:-100px;",
  18: "width:250px; margin-top:-100px;",
  19: "width:250px; margin-top:-100px;",
  20: "width:250px; margin-top:-100px;",
  21: "width:250px; margin-top:-100px;",
  25: "width:250px; margin-top:-100px;",
  26: "width:250px; margin-top:-100px;",
  30: "width:250px; margin-top:-100px;",
  32: "width:250px; margin-top:-100px;",
  34: "width:250px; margin-top:-100px;",
  35: "width:250px; margin-top:-100px;",
  36: "width:250px; margin-top:-100px;",
  37: "width:250px; margin-top:-100px;",
  38: "width:250px; margin-top:-100px;",
  40: "width:250px; margin-top:-100px;",
  42: "width:250px; margin-top:-100px;",
  43: "width:250px; margin-top:-100px;",
  45: "width:250px; margin-top:-100px;",
  49: "width:250px; margin-top:-100px;",
  51: "width:250px; margin-top:-100px;",
58: "width:250px; margin-top:-100px;",
59: "width:250px; margin-top:-100px;",
60: "width:250px; margin-top:-100px;",
62: "width:250px; margin-top:-100px;",
63: "width:250px; margin-top:-100px;",
66: "width:250px; margin-top:-100px;",
72: "width:250px; margin-top:-100px;",
73: "width:250px; margin-top:-100px;",
74: "width:250px; margin-top:-100px;",
75: "width:250px; margin-top:-100px;",
77: "width:250px; margin-top:-100px;",
79: "width:250px; margin-top:-100px;",
81: "width:250px; margin-top:-100px;",
82: "width:250px; margin-top:-100px;",
85: "width:250px; margin-top:-100px;",
91: "width:250px; margin-top:-100px;",
93: "width:250px; margin-top:-100px;",
94: "width:250px; margin-top:-100px;",
95: "width:250px; margin-top:-100px;",
103: "width:250px; margin-top:-100px;",
104: "width:250px; margin-top:-100px;",
106: "width:250px; margin-top:-100px;",
112: "width:250px; margin-top:-100px;",
113: "width:250px; margin-top:-100px;",
114: "width:250px; margin-top:-100px;",
115: "width:250px; margin-top:-100px;",
120: "width:250px; margin-top:-100px;",
121: "width:250px; margin-top:-100px;",
129: "width:250px; margin-top:-100px;",
134: "width:250px; margin-top:-100px;",
137: "width:250px; margin-top:-100px;",
139: "width:250px; margin-top:-100px;",
141: "width:250px; margin-top:-100px;",
144: "width:250px; margin-top:-100px;",
146: "width:250px; margin-top:-100px;",
147: "width:250px; margin-top:-100px;",
149: "width:250px; margin-top:-100px;",
151: "width:250px; margin-top:-100px;",
154: "width:250px; margin-top:-100px;",
155: "width:250px; margin-top:-100px;",
156: "width:250px; margin-top:-100px;",
159: "width:250px; margin-top:-100px;"

};

const pageTextStyles = {
  0: "margin-top:1rem;",
  1: "margin-top:0px;",
  2: "margin-top:50px;",
  3: "margin-top:0px;",
  4: "margin-top:50px;",
  5: "margin-top:0px;",
  6: "margin-top:50px;",
  7: "margin-top:50px;",
  8: "margin-top:50px;",
  9: "margin-top:50px;",
  10: "margin-top:50px;",
  11: "margin-top:0px;",
  12: "margin-top:0px;",
  15: "margin-top:50px;",
  17: "margin-top:50px;",
  18: "margin-top:50px;",
  19: "margin-top:50px;",
  20: "margin-top:50px;",
  21: "margin-top:50px;",
  22: "margin-top:0px;",
  23: "margin-top:0px;",
  24: "margin-top:0px;",
  25: "margin-top:50px;",
  26: "margin-top:50px;",
  27: "margin-top:0px;",
  28: "margin-top:0px;",
  29: "margin-top:0px;",
  30: "margin-top:50px;",
  31: "margin-top:0px;",
  32: "margin-top:50px;",
  33: "margin-top:0px;",
  34: "margin-top:50px;",
  35: "margin-top:50px;",
  36: "margin-top:50px;",
  37: "margin-top:50px;",
  38: "margin-top:50px;",
  39: "margin-top:0px;",
  40: "margin-top:50px;",
  41: "margin-top:0px;",
  42: "margin-top:50px;",
  43: "margin-top:50px;",
  44: "margin-top:0px;",
  45: "margin-top:50px;",
  46: "margin-top:0px;",
  47: "margin-top:0px;",
  48: "margin-top:0px;",
  49: "margin-top:50px;",
  50: "margin-top:0px;",
  51: "margin-top:50px;",
  52: "margin-top:-100px;",
  53: "margin-top:0px;",
  54: "margin-top:0px;",
55: "margin-top:0px;",
56: "margin-top:0px;",
57: "margin-top:0px;",
58: "margin-top:50px;",
59: "margin-top:50px;",
60: "margin-top:50px;",
61: "margin-top:0px;",
62: "margin-top:50px;",
63: "margin-top:50px;",
64: "margin-top:0px;",
65: "margin-top:0px;",
66: "margin-top:50px;",
67: "margin-top:0px;",
68: "margin-top:0px;",
69: "margin-top:0px;",
70: "margin-top:0px;",
71: "margin-top:0px;",
72: "margin-top:50px;",
73: "margin-top:50px;",
74: "margin-top:50px;",
75: "margin-top:50px;",
78: "margin-top:0px;",
79: "margin-top:50px;",
80: "margin-top:0px;",
81: "margin-top:50px;",
82: "margin-top:50px;",
83: "margin-top:0px;",
84: "margin-top:0px;",
85: "margin-top:50px;",
86: "margin-top:0px;",
87: "margin-top:0px;",
88: "margin-top:0px;",
89: "margin-top:0px;",
90: "margin-top:0px;",
91: "margin-top:50px;",
92: "margin-top:0px;",
93: "margin-top:50px;",
94: "margin-top:50px;",
95: "margin-top:50px;",
96: "margin-top:0px;",
97: "margin-top:0px;",
98: "margin-top:0px;",
99: "margin-top:0px;",
100: "margin-top:0px;",
101: "margin-top:0px;",
102: "margin-top:0px;",
103: "margin-top:50px;",
104: "margin-top:50px;",
105: "margin-top:0px;",
106: "margin-top:50px;",
107: "margin-top:0px;",
108: "margin-top:0px;",
109: "margin-top:0px;",
110: "margin-top:0px;",
111: "margin-top:0px;",
112: "margin-top:50px;",
113: "margin-top:50px;",
114: "margin-top:50px;",
115: "margin-top:50px;",
116: "margin-top:0px;",
117: "margin-top:0px;",
118: "margin-top:0px;",
119: "margin-top:0px; color:red;",
120: "margin-top:50px;",
121: "margin-top:50px;",
122: "margin-top:0px;",
123: "margin-top:0px;",
124: "margin-top:0px;",
125: "margin-top:0px;",
126: "margin-top:0px;",
127: "margin-top:0px;",
128: "margin-top:0px;",
129: "margin-top:50px;",
130: "margin-top:0px;",
131: "margin-top:0px;",
132: "margin-top:0px;",
133: "margin-top:0px;",
134: "margin-top:50px;",
135: "margin-top:0px;",
136: "margin-top:0px;",
137: "margin-top:50px;",
138: "margin-top:0px;",
139: "margin-top:50px;",
140: "margin-top:0px;",
141: "margin-top:50px;",
142: "margin-top:0px;",
143: "margin-top:0px;",
144: "margin-top:50px;",
145: "margin-top:0px;",
146: "margin-top:50px;",
147: "margin-top:50px;",
148: "margin-top:0px;",
149: "margin-top:50px;",
150: "margin-top:0px;",
151: "margin-top:50px;",
152: "margin-top:0px;",
153: "margin-top:0px;",
154: "margin-top:50px;",
155: "margin-top:50px;",
156: "margin-top:50px;",
157: "margin-top:0px;",
158: "margin-top:0px;",
159: "margin-top:50px;"



};

const pageCodes = {
  38: "576",
77:"3546"
};

// 페이지별 선택지
const pageChoices = {
  10000: [
  { text: "책장 조사", goto: 10000 },
    { text: "가방 조사", goto: 10003 },
    { text: "액자 조사", goto: 10005 },
    { text: "금고 조사", goto: 10007 }
  ]
};

const pageBGMs = {
  1: "./bgm.mp3",
  52: "./bgm3.mp3",
85: "./bgm2.mp3",
119: "./무언가.mp3",
127: "./bgm4.mp3"
};

// 페이지별 효과음
const pageSFX = {
  10002: "./wake_up.mp3",
  1000: "./introduce.mp3",
  1001: "./puzzle.mp3",
  391: "./correct.mp3",
  5211: "./chapter.mp3"
};

// 페이지별 영상
const pageVideos = {
  10000: "./영상.mp4"
};

// 페이지별 영상 스타일
const pageVideoStyles = {
  10000: "width:500px; margin-top:20px;"
};

function showConfirmPopup() {
  const popup = document.getElementById("confirmPopup");
  popup.style.display = "flex";

  document.getElementById("yesBtn").onclick = () => {
    localStorage.removeItem("currentPage");
    localStorage.removeItem("pageHistory");
    currentPage = 1;
    pageHistory = [];
    popup.style.display = "none";
    showPage();
  };

  document.getElementById("noBtn").onclick = () => {
    popup.style.display = "none";
  };
}

function showPage() {
  const card = document.getElementById('card');
  const backBtn = document.getElementById("backBtn");
  const saved = localStorage.getItem("currentPage");

  if (currentPage === 0) backBtn.style.display = "none";
  else backBtn.style.display = "block";

  if (currentPage === 0) {
    card.innerHTML = `
      <img src="./Dream Time.jpg" style="width:350px; margin-top:10px;">
      <p style="margin-top:1rem;">클릭하여 시작<br></p>
      ${saved && saved > 0 ? `<button id="continueBtn">이어하기</button>` : ""}
    `;

    if (saved && saved > 0) {
      document.getElementById("continueBtn").addEventListener("click", (e) => {
        e.stopPropagation();
        currentPage = parseInt(saved);
        // 히스토리도 복원
        const savedHistory = localStorage.getItem("pageHistory");
        if (savedHistory) {
          pageHistory = JSON.parse(savedHistory);
        }
        showPage();
      });
    }
    return;
  }

  // 페이지가 존재하지 않으면 에러 표시
  if (!pages[currentPage]) {
    card.innerHTML = `<p style="color:#ef4444;">페이지 ${currentPage}가 존재하지 않습니다.</p>`;
    return;
  }

  if (currentPage >= pages.length) {
    card.innerHTML = "마지막 페이지입니다.";
    return;
  }

  // BGM 변경
  if (pageBGMs[currentPage]) {
    audio.pause();
    audio.src = pageBGMs[currentPage];
    audio.play().catch(() => {});
  }

  // 효과음 재생
  if (pageSFX[currentPage]) {
    sfx.src = pageSFX[currentPage];
    sfx.play().catch(() => {});
  }

  // 선택지 페이지
  if (pageChoices[currentPage]) {
    let choicesHTML = '';
    pageChoices[currentPage].forEach((choice, index) => {
      choicesHTML += `<button class="choice-btn" data-goto="${choice.goto}">${choice.text}</button>`;
    });

    card.innerHTML = `
      ${pageVideos[currentPage] ? `<video id="pageVideo" loop style="${pageVideoStyles[currentPage] || 'width:500px;'}"><source src="${pageVideos[currentPage]}" type="video/mp4"></video>` : ""}
      ${pageImages[currentPage] ? `<img src="${pageImages[currentPage]}" style="${pageImageStyles[currentPage]}">` : ""}
      <p style="${pageTextStyles[currentPage]}">${pages[currentPage]}</p>
      <div style="margin-top: 1.5rem;">
        ${choicesHTML}
      </div>
    `;

    // 영상이 있으면 재생
    if (pageVideos[currentPage]) {
      const video = document.getElementById('pageVideo');
      if (video) {
        video.muted = !audioUnlocked;  // 잠금 해제 여부에 따라
        video.play().catch(() => {
          // 실패하면 음소거로 재생
          video.muted = true;
          video.play().catch(() => {});
        });
      }
    }

    // 선택지 버튼 이벤트
    document.querySelectorAll('.choice-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        pageHistory.push(currentPage);
        currentPage = parseInt(btn.dataset.goto);
        localStorage.setItem("currentPage", currentPage);
        localStorage.setItem("pageHistory", JSON.stringify(pageHistory));
        showPage();
      });
    });
    return;
  }

  if (pageCodes[currentPage]) {
    card.innerHTML = `
      ${pageVideos[currentPage] ? `<video id="pageVideo" loop style="${pageVideoStyles[currentPage] || 'width:500px;'}"><source src="${pageVideos[currentPage]}" type="video/mp4"></video>` : ""}
      ${pageImages[currentPage] ? `<img src="${pageImages[currentPage]}" style="${pageImageStyles[currentPage]}">` : ""}
      <p style="${pageTextStyles[currentPage]}">${pages[currentPage]}</p>
      <input type="text" id="codeInput" placeholder="코드입력"><br>
      <button id="submitBtn">확인</button>
      <p id="msg"></p>
    `;

    // 영상이 있으면 재생
    if (pageVideos[currentPage]) {
      const video = document.getElementById('pageVideo');
      if (video) {
        video.muted = !audioUnlocked;
        video.play().catch(() => {
          video.muted = true;
          video.play().catch(() => {});
        });
      }
    }

    const codeInput = document.getElementById('codeInput');
    const submitBtn = document.getElementById('submitBtn');

    const checkCode = (e) => {
      e.stopPropagation();
      const entered = codeInput.value.trim();
      const msg = document.getElementById('msg');
      if (entered === pageCodes[currentPage]) {
        currentPage++;
        localStorage.setItem("currentPage", currentPage);
        showPage();
      } else {
        msg.textContent = "코드가 틀렸습니다!";
        codeInput.value = '';
        codeInput.focus();
      }
    };

    submitBtn.addEventListener('click', checkCode);
    
    codeInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        checkCode(e);
      }
    });

    setTimeout(() => codeInput.focus(), 100);

  } else {
    card.innerHTML = `
      ${pageVideos[currentPage] ? `<video id="pageVideo" loop style="${pageVideoStyles[currentPage] || 'width:500px;'}"><source src="${pageVideos[currentPage]}" type="video/mp4"></video>` : ""}
      ${pageImages[currentPage] ? `<img src="${pageImages[currentPage]}" style="${pageImageStyles[currentPage]}">` : ""}
      <p style="${pageTextStyles[currentPage]}">${pages[currentPage]}</p>
    `;

    // 영상이 있으면 재생
    if (pageVideos[currentPage]) {
      const video = document.getElementById('pageVideo');
      if (video) {
        video.muted = !audioUnlocked;
        video.play().catch(() => {
          video.muted = true;
          video.play().catch(() => {});
        });
      }
    }
  }
}

wrap.addEventListener('click', () => {
  // 선택지나 코드 입력 페이지에서는 클릭 무시
  if (pageCodes[currentPage] || pageChoices[currentPage]) return;

  if (currentPage === 0) {
    const saved = localStorage.getItem("currentPage");

    if (saved && saved > 0) {
      showConfirmPopup();
      return;
    }

    audio.play().catch(() => {});
    audioUnlocked = true;  // 오디오 잠금 해제
    currentPage = 1;
    localStorage.setItem("currentPage", currentPage);
    showPage();
    return;
  }

  if (pages[currentPage + 1]) {
    currentPage++;
    // 일반 진행은 히스토리 초기화 (선택지 아닌 경우)
    pageHistory = [];
    localStorage.setItem("currentPage", currentPage);
    localStorage.setItem("pageHistory", JSON.stringify(pageHistory));
    showPage();
  }
});

document.getElementById("backBtn").addEventListener("click", () => {
  if (pageHistory.length > 0) {
    // 히스토리가 있으면 히스토리에서 가져오기
    currentPage = pageHistory.pop();
    localStorage.setItem("currentPage", currentPage);
    localStorage.setItem("pageHistory", JSON.stringify(pageHistory));
    showPage();
  } else if (currentPage > 0) {
    // 히스토리가 없으면 일반적인 뒤로가기
    currentPage--;
    localStorage.setItem("currentPage", currentPage);
    showPage();
  }
});

document.addEventListener("keydown", (e) => {
  if (e.key === "ArrowLeft") {
    if (pageHistory.length > 0) {
      // 히스토리가 있으면 히스토리에서 가져오기
      currentPage = pageHistory.pop();
      localStorage.setItem("currentPage", currentPage);
      localStorage.setItem("pageHistory", JSON.stringify(pageHistory));
      showPage();
    } else if (currentPage > 0) {
      // 히스토리가 없으면 일반적인 뒤로가기
      currentPage--;
      localStorage.setItem("currentPage", currentPage);
      showPage();
    }
  } else if (e.key === "ArrowRight" && pages[currentPage + 1] && !pageCodes[currentPage] && !pageChoices[currentPage]) {
    currentPage++;
    localStorage.setItem("currentPage", currentPage);
    showPage();
  }
});

showPage();
</script>
</body>
</html>
